<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Laporan Kendala</title>

  <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="logo.jpg" />

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      background-color: #f1f5f9;
      font-family: 'Segoe UI', sans-serif;
    }

    .form-container {
      max-width: 700px;
      margin: 40px auto;
      background: #ffffff;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    .form-title {
      color: #1e40af;
      font-weight: bold;
      text-align: center;
      margin-bottom: 30px;
    }

    .logo {
      display: block;
      margin: 0 auto 15px auto;
      max-width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .form-label {
      font-weight: 600;
    }

    .btn-primary {
      background-color: #2563eb;
      border: none;
    }

    .btn-primary:hover {
      background-color: #1e40af;
    }

    .spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(255, 255, 255, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      display: none;
    }
  </style>
</head>
<body>

<!-- Form Container -->
<div class="container form-container">
  <img src="logo.jpg" alt="Logo" class="logo">
  <h1 class="form-title">Laporan Kendala</h1>
  <form id="laporanForm">
    <input type="hidden" id="submissionId" name="submissionId" readonly>
    <input type="hidden" id="timestamp" name="timestamp" readonly>

    <div class="mb-3">
      <label for="nama" class="form-label">Nama Lengkap</label>
      <input type="text" class="form-control" id="nama" name="nama" required>
    </div>

    <div class="mb-3">
      <label for="nim" class="form-label">NIM</label>
      <input type="text" class="form-control" id="nim" name="nim" required>
    </div>

    <div class="mb-3">
      <label for="kelompok" class="form-label">Kelompok</label>
      <input type="text" class="form-control" id="kelompok" name="kelompok" required>
    </div>

    <div class="mb-3">
      <label for="jenis" class="form-label">Jenis Kendala</label>
      <input type="text" class="form-control" id="jenis" name="jenis" required>
    </div>

    <div class="mb-3">
      <label for="penjelasan" class="form-label">Penjelasan Kendala</label>
      <textarea class="form-control" id="penjelasan" name="penjelasan" rows="4" required></textarea>
    </div>

    <div class="mb-3">
      <label for="screenshot" class="form-label">Upload Screenshot</label>
      <input type="file" class="form-control" id="screenshot" name="screenshot" accept="image/*">
    </div>

    <button type="submit" class="btn btn-primary w-100">
      ðŸš€ Kirim Laporan
    </button>
  </form>
</div>

<!-- Spinner Loading -->
<div id="spinnerOverlay" class="spinner-overlay">
  <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<!-- Modal Alert -->
<div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="statusModalLabel">Status</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
      </div>
      <div class="modal-body" id="modalMessage">
        <!-- Message will be inserted here -->
      </div>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const submissionId = Math.floor(10000 + Math.random() * 90000);
    document.getElementById("submissionId").value = submissionId;
    document.getElementById("timestamp").value = new Date().toISOString();

    const form = document.getElementById("laporanForm");
    const spinner = document.getElementById("spinnerOverlay");
    const modal = new bootstrap.Modal(document.getElementById("statusModal"));
    const modalMessage = document.getElementById("modalMessage");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      spinner.style.display = "flex";

      const screenshotInput = document.getElementById("screenshot");
      const file = screenshotInput.files[0];

      const base64 = file ? await toBase64(file) : "";
      const fileName = file ? file.name : "";

      const data = new URLSearchParams();
      data.append("submissionId", document.getElementById("submissionId").value);
      data.append("nama", document.getElementById("nama").value);
      data.append("nim", document.getElementById("nim").value);
      data.append("kelompok", document.getElementById("kelompok").value);
      data.append("jenis", document.getElementById("jenis").value);
      data.append("penjelasan", document.getElementById("penjelasan").value);
      data.append("fileBase64", base64);
      data.append("fileName", fileName);

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbznigqrzaGzIFqzJTX_hFJAuZbVD5FgNq40SmMya6Qm5QGHJ5zDKtn1-0QGv3DJKIHf8w/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: data
        });

        const result = await response.text();
        spinner.style.display = "none";

        if (response.ok) {
          modalMessage.textContent = "âœ… Laporan berhasil dikirim!";
          form.reset();
        } else {
          modalMessage.textContent = "âŒ Gagal mengirim laporan. " + result;
        }
        modal.show();
      } catch (error) {
        spinner.style.display = "none";
        modalMessage.textContent = "âš ï¸ Terjadi kesalahan: " + error.message;
        modal.show();
      }
    });

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          const base64String = reader.result.split(',')[1];
          resolve(base64String);
        };
        reader.onerror = error => reject(error);
      });
    }
  });
</script>

</body>
</html>